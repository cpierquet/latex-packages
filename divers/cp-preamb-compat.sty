\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cp-preamb-compat}[2023/06/20 Préambule de compatbilite, v0.1.a]
% 0.1.a	Version initiale, avec gros nettoyage !!!!!!

% ===================stylev2 pour les boîtes
\newif\if@newstyle \@newstyletrue
\DeclareOption{AncienStyle}{\@newstylefalse}
% ======commandes exos [sujet/sujetl/revgoku]
\newif\if@sujet \@sujetfalse
\DeclareOption{sujet}{\@sujettrue}
\newif\if@sujetl \@sujetlfalse
\DeclareOption{sujetl}{\@sujetltrue}
\newif\if@revgoku \@revgokufalse
\DeclareOption{revgoku}{\@revgokutrue}
% ============================fin des options
\DeclareOption*{}%si option inconnue ;-)
\ProcessOptions\relax

% ======================================Maths
\newcommand\courbe[1]{\mathscr{C}_{#1}}
\newcommand\loinorm[3]{#1 \hookrightarrow \mathcallig{N} \left(#2;#3\right)}
\newcommand\binomiale[2]{\mathcallig{B} \left(#1;#2\right)}
\newcommand\loibinom[3]{#1 \hookrightarrow \mathcallig{B} \left(#2;#3\right)}
\newcommand\normale[2]{\mathcallig{N} \left(#1;#2\right)}
\newcommand\suiten[1][u]{\left( #1_n \right)}
\newcommand\suiteun{\left( u_n \right)}
\newcommand\suitevn{\left( v_n \right)}
\newcommand\matdeux[4]{\begin{pmatrix} #1 & #2 \\ #3 & #4 \end{pmatrix}}
\newcommand\etprob[2]{\begin{pmatrix} #1 & #2 \end{pmatrix}}
\newcommand\coordpl[2]{\left(#1;#2\right)}
\newcommand\coordes[3]{\left(#1;#2;#3\right)}
\newcommand\coordeux[2]{\begin{pmatrix} #1 \\ #2 \end{pmatrix}}
\newcommand\coordve[3]{\begin{pmatrix} #1 \\ #2 \\ #3 \end{pmatrix}}

%ancienne version avec [option] du package ?
\newcommand\exonum[1]{\addtocounter{numexos}{1}{\textbf{\Large \textcolor{titrebleu}{Exercice \thenumexos \hfill (#1 points)}}}}
\if@revgoku
	\renewcommand\exonum[2][]{%exercice... avec trait horizontal etéventuellement goku
		\ifthenelse{\equal{#2}{}}%
		{%
			\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
			\addtocounter{numexos}{1}{\sffamily\textbf{\LARGE \textcolor{titrebleu}{Exercice \thenumexos{#1}~{\color{titrebleu}\hrulefill}}}}%
			\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
		}%
		{%
			\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
			\addtocounter{numexos}{1}{\sffamily\textbf{\LARGE \textcolor{titrebleu}{Exercice \thenumexos{#1}~{\color{titrebleu}\hrulefill}\niveaudif{#2}}}}%
			\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
		}
	}
\fi

\newcommand\exogen[1]{%exercice... avec trait horizontal
	\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
	{\sffamily\textbf{\LARGE \textcolor{titrebleu}{Exercice#1~{\color{titrebleu}\hrulefill}}}}%
	\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
}

\newcommand\exotitre[1]{%... avec trait horizontal
	\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
	{\sffamily\textbf{\LARGE \textcolor{titrebleu}{#1~{\color{titrebleu}\hrulefill}}}}%
	\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
}

\if@sujet
	\renewcommand\exonum[2][]{%exercice ... avec trait horizontal et points
		\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
		\ifthenelse{\equal{#2}{1}}%
		{%
			\def\pts{point}
		}%
		{%
			\def\pts{points}
		}
		\addtocounter{numexos}{1}{\sffamily\textbf{\LARGE \textcolor{titrebleu}{Exercice \thenumexos#1~{\color{titrebleu}\hrulefill~(#2 \pts)}}}}%
		\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
	}
	\newcommand\exoannexe[1]{%annexe exercice ... avec trait horizontal et points
		\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
		{\sffamily\textbf{\LARGE \textcolor{titrebleu}{Annexe Exercice#1~{\color{titrebleu}\hrulefill}}}}%
		\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
	}
	\newcommand\exocours[1]{%question de cours avec trait horizontal et points
		\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
		{\sffamily\textbf{\LARGE \textcolor{titrebleu}{Questions de cours~{\color{titrebleu}\hrulefill~(#1 points)}}}}%
		\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
	}
	\newcommand\exogenerique[2]{%... avec trait horizontal et ce qu'on veut entre (...)
		\def\hrulefill{\leavevmode\leaders\hrule height 1.1pt\hfill\kern\z@}%épaisseur
		{\sffamily\textbf{\LARGE \textcolor{titrebleu}{#1~{\color{titrebleu}\hrulefill~(#2)}}}}%
		\def\hrulefill{\leavevmode\leaders\hrule height 0.4pt\hfill\kern\z@}
	}
\fi

% ===========================tableaux de base
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash }b{#1}} 
\newcolumntype{L}[1]{>{\raggedright\arraybackslash }b{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash }m{#1}} %doublecentrée
\renewcommand{\tabularxcolumn}[1]{m{#1}}
\newcolumntype{Y}{>{\centering\arraybackslash }X}

%==============================commandes tikz
\newcommand\papierseyes{\@ifstar{\papierseyes@star}{\papierseyes@nostar}}
\newcommand\papierseyes@nostar[2]{%
	\begin{center}
		\begin{tikzpicture}[x=0.8cm,y=0.8cm]
			\draw[xstep=1,ystep=0.2,line width=0.2pt,color=cyan!50] (0,0) grid (#1,#2);
			\draw[xstep=1,ystep=1,line width=0.4pt,color=cyan] (0,0) grid (#1,#2);
		\end{tikzpicture}
	\end{center}%
	}
\newcommand\papierseyes@star[2]{%
	\begin{tikzpicture}[x=0.8cm,y=0.8cm]
		\draw[xstep=1,ystep=0.2,line width=0.2pt,color=cyan!50] (0,0) grid (#1,#2);
		\draw[xstep=1,ystep=1,line width=0.4pt,color=cyan] (0,0) grid (#1,#2);
	\end{tikzpicture}%
}

\newcommand\newpapierseyes[2]{%
	\begin{tikzpicture}[x=0.8cm,y=0.8cm]
		\draw[xstep=1,ystep=0.2,color=LightSteelBlue] (0,0) grid ({#1-3},#2);
		\draw[xstep=1,ystep=1,color=Plum] (0,0) grid ({#1-3},#2);
		\foreach \LL in {0,0.2,...,#2} {\draw[color=LightSteelBlue] (-3,\LL)--(0,\LL) ; }
		\draw[color=Plum] (-3,0)--(-3,#2) ;
		\foreach \L in {0,1,...,#2} {\draw[color=Plum] (-3,\L)--(0,\L) ; }
		\draw[thick,red!75] (0,0)--(0,#2) ;
	\end{tikzpicture}%
}

\tikzset{cross/.pic={\draw[rotate=45] (-#1,0) -- (#1,0);\draw[rotate=45] (0,-#1) -- (0, #1);}
}

\tikzset{pics/dotcross/.style args={#1}{
		code={
			\draw[line width={0.5*#1},rotate=45] (-#1,0) -- (#1,0);
			\draw[line width={0.5*#1},rotate=45] (0,-#1) -- (0, #1);
		}
	},
	pics/dotcross/.default=4pt
}

\tikzset{hachures/.style args={line width=#1pt,angle=#2,distance=#3}{
		pattern={Lines[line width=#1pt,angle=#2,distance=#3]}},
		hachures/.default={line width=1pt,angle=45,distance=5pt}
}

\tikzset{arrowinside/.style 2 args={postaction={decorate},decoration={markings,mark=at position #1 with {\arrow[scale=#2]{>}}}}}

\tikzset{%
	Ox/.store in=\axexOx,Ox/.default=0,Ox=0,%essai
	Oy/.store in=\axeyOy,Oy/.default=0,Oy=0,%essai
	xmin/.store in=\xmin,xmin/.default=-5,xmin=-5,
	xmax/.store in=\xmax,xmax/.default=5,xmax=5,
	ymin/.store in=\ymin,ymin/.default=-5,ymin=-5,
	ymax/.store in=\ymax,ymax/.default=5,ymax=5,
	xgrille/.store in=\xgrille,xgrille/.default=1,xgrille=1,
	xgrilles/.store in=\xgrilles,xgrilles/.default=0.5,xgrilles=0.5,
	ygrille/.store in=\ygrille,ygrille/.default=1,ygrille=1,
	ygrilles/.store in=\ygrilles,ygrilles/.default=0.5,ygrilles=0.5,
	xunit/.store in=\xunit,xunit/.default=1,xunit=1,
	yunit/.store in=\yunit,yunit/.default=1,yunit=1
}

\newcommand\tunits[2]{%
	\def\xunit{#1}\def\yunit{#2}
}

\newcommand\tdefgrille[8]{%
	\def\xmin{#1}\def\xmax{#2}\def\ymin{#5}\def\ymax{#6}
	\def\xgrille{#3}\def\xgrilles{#4}\def\ygrille{#7}\def\ygrilles{#8}
}

\newcommand\tgrilles[1][ultra thin,lightgray]{%
	\draw[xstep=\xgrilles,ystep=\ygrilles,#1] (\xmin,\ymin) grid (\xmax,\ymax);
}
\newcommand\tgrillep[1][thin,gray]{%
	\draw[xstep=\xgrille,ystep=\ygrille,#1] (\xmin,\ymin) grid (\xmax,\ymax);
}

\define@key{tikzaxex}{Ox}{\def\axex@Ox{#1}}
\define@key{tikzaxex}{width}{\def\axex@width{#1}}
\define@key{tikzaxex}{font}{\def\axex@font{#1}}
\define@key{tikzaxex}{size}{\def\axex@size{#1}}
\define@key{tikzaxex}{tickwidth}{\def\axex@tickwidth{#1}}
\define@key{tikzaxey}{Oy}{\def\axey@Oy{#1}}
\define@key{tikzaxey}{width}{\def\axey@width{#1}}
\define@key{tikzaxey}{size}{\def\axey@size{#1}}
\define@key{tikzaxey}{tickwidth}{\def\axey@tickwidth{#1}}
\define@key{tikzaxes}{width}{\def\axes@width{#1}}
\define@key{tikzaxey}{font}{\def\axey@font{#1}}
\define@key{tikzaxes}{labelx}{\def\axes@labelx{#1}}
\define@key{tikzaxes}{labely}{\def\axes@labely{#1}}
\define@key{tikzaxes}{poslabelx}{\def\axes@poslabelx{#1}}
\define@key{tikzaxes}{poslabely}{\def\axes@poslabely{#1}}
\define@key{tikzaxes}{echellefleche}{\def\axes@echellefleche{#1}}
\define@key{tikzaxes}{typefleche}{\def\axes@typefleche{#1}}
\setkeys{tikzaxex}{Ox=0,width=1.25pt,size=\normalsize,tickwidth=4pt,font=\normalfont}
\setkeys{tikzaxey}{Oy=0,width=1.25pt,size=\normalsize,tickwidth=4pt,font=\normalfont}
\setkeys{tikzaxes}{width=1.25pt,labelx=,labely=,poslabelx=right,poslabely=above,echellefleche=1,typefleche=>}

\newcommand\axextikz{\@ifstar{\axextikz@star}{\axextikz@nostar}}
\newcommand\axextikz@nostar[2][]{%
	\setkeys{tikzaxex}{#1}% on paramètres les nouvelles clés
	\foreach \x in {#2}{%
		\draw[line width=\axex@width] ({\x-\axex@Ox},{\axex@tickwidth}) -- ({\x-\axex@Ox},{-\axex@tickwidth}) node[below,font=\axex@font] {\axex@size \num[text-family-to-math=true,text-series-to-math=true]{\x}};}
}
\newcommand\axextikz@star[2][]{%
	\setkeys{tikzaxex}{#1}% on paramètres les nouvelles clés
	\foreach \x in {#2}{%
		\draw[line width=\axex@width] ({\x-\axex@Ox},{\axex@tickwidth}) -- ({\x-\axex@Ox},{-\axex@tickwidth});}
}
%à garder si ça buggue... node[below] {\axex@size \num{\x}}

\newcommand\axeytikz{\@ifstar{\axeytikz@star}{\axeytikz@nostar}}
\newcommand\axeytikz@nostar[2][]{%
	\setkeys{tikzaxey}{#1}% on paramètres les nouvelles clés
	\foreach \y in {#2}{%
		\draw[line width=\axey@width] ({\axey@tickwidth},{\y-\axey@Oy}) -- ({-\axey@tickwidth},{\y-\axey@Oy}) node[left,font=\axey@font] {\axey@size \num[text-family-to-math=true,text-series-to-math=true]{\y}};}
}
\newcommand\axeytikz@star[2][]{%
	\setkeys{tikzaxey}{#1}% on paramètres les nouvelles clés
	\foreach \y in {#2}{%
		\draw[line width=\axey@width] ({\axey@tickwidth},{\y-\axey@Oy}) -- ({-\axey@tickwidth},{\y-\axey@Oy});}
}

\newcommand\axestikz{\@ifstar{\axestikz@star}{\axestikz@nostar}}

\newcommand\axestikz@nostar[1][]{%
	\setkeys{tikzaxes}{#1}% on paramètres les nouvelles clés
	{\draw[line width=\axes@width,-{\axes@typefleche[scale=\axes@echellefleche]}] (\xmin,0) -- (\xmax,0) node[\axes@poslabelx] {\axes@labelx} ;
	\draw[line width=\axes@width,-{\axes@typefleche[scale=\axes@echellefleche]}] (0,\ymin) -- (0,\ymax) node[\axes@poslabely] {\axes@labely} ;}
}

\newcommand\axestikz@star[1][]{%
	\setkeys{tikzaxes}{#1}% on paramètres les nouvelles clés
	{\draw[line width=\axes@width,-{\axes@typefleche[scale=\axes@echellefleche]}] (\xmin,0) -- (\xmax,0) ;
	\draw[line width=\axes@width,-{\axes@typefleche[scale=\axes@echellefleche]}] (0,\ymin) -- (0,\ymax);}
}

\newcommand\tcoord[3][line width=1pt,dashed,ForestGreen,arrowinside={0.5}{1}]{%
	{\draw[#1] (#2,0) -- (#2,#3) ;
	\draw[#1] (#2,#3) -- (0,#3) ;}
}

%======ancien style
\if@newstyle

\if@breakable
	\tcbuselibrary{breakable}
	\tcbset{cdefaut/.style={%
			fonttitle=\fontbox,%
			enhanced,breakable,center,boxrule=1.25pt,drop shadow=black!33!white,%
			sharp corners=uphill,arc=12pt,before skip=12pt,after skip=12pt,%
			left=5pt,leftupper=5pt,top=1mm,bottom=1mm,%
			before upper=\leavevmode
		}
	}
\else
	\tcbset{cdefaut/.style={%
			fonttitle=\fontbox,%
			enhanced,center,boxrule=1.25pt,drop shadow=black!33!white,%
			sharp corners=uphill,arc=12pt,before skip=12pt,after skip=12pt,%
			left=5pt,leftupper=5pt,top=1mm,bottom=1mm,%
			before upper=\leavevmode
		}
	}
\fi

\NewDocumentCommand\cpnewbox{ m m m m O{#4} !O{} }{%nom + titre + icone + bordure/titre/fondtitre + couleur fond + options
	\DeclareTColorBox{#1}{ O{} }{%
		cdefaut,%
		colframe=#4,coltitle=#4!25!Black,colbacktitle=#4!35,colback=#5!10,%
		title={#3\:\:\titrebox{#2##1}},%
		#6
	}%
}

\cpnewbox{cdefi}{Définition}{\faIcon[regular]{comment-dots}}{ForestGreen}
\cpnewbox{chumour}{Humour}{\faIcon[regular]{laugh-wink}}{Yellow}
\cpnewbox{cprop}{Propriété}{\faCog}{Salmon}
\cpnewbox{ccscq}{Conséquence}{\faArrowAltCircleRight[regular]}{Salmon}
\cpnewbox{cthm}{Théorème}{\faBullhorn}{FireBrick}
\cpnewbox{clog}{Logiciel}{\faDev}{CornflowerBlue}[white]
\cpnewbox{chistoire}{Point histoire}{\faUniversity}{Chocolate}[white]
\cpnewbox{crmq}{Remarque}{\faHandPointRight[regular]}{MidnightBlue}[white]
\cpnewbox{cexercice}{Exercice}{\faHubspot}{MidnightBlue}
\cpnewbox{cexemple}{Exemple}{\faHubspot}{MediumTurquoise}
\cpnewbox{cvoc}{Vocabulaire}{\faList*[regular]}{YellowGreen}
\cpnewbox{cnota}{Notation}{\faList*}{YellowGreen}
\cpnewbox{ccadre}{Cadre}{\faInfoCircle}{Peru}
\cpnewbox{cidee}{Idée}{\faInfo}{LightBlue}
\cpnewbox{cintro}{Intro}{\faMarker}{LightSalmon}
\cpnewbox{cillustr}{Illustration}{\faChartLine}{Crimson}[White]
\cpnewbox{cvideo}{}{\faIcon[regular]{file-video}}{teal}[White]
\cpnewbox{cbilan}{Bilan}{\faForward}{Purple}
\cpnewbox{cmethode}{Méthode}{\faTasks}{Coral}
\cpnewbox{ctuto}{Tuto}{\faTerminal}{Coral}[White]
\cpnewbox{cmanip}{Manipulation}{\faCodeBranch}{DarkCyan}[White]
\cpnewbox{ccalco}{Calculatrice}{\faCalculator}{MediumVioletRed}[White]
\cpnewbox{coutil}{Outil}{\faTools}{DeepSkyBlue}[White]
\cpnewbox{casavoir}{À savoir}{\faHeart}{Red}
\cpnewbox{cbloctd}{TD}{\faHourglassStart}{LightSeaGreen}[White]
\cpnewbox{cblocdm}{À vous de jouer}{\faHourglassStart}{LightSeaGreen}[White]
\cpnewbox{crappel}{Rappel}{\faHandPointUp[regular]}{LightSalmon}
\cpnewbox{cresol}{Résolution}{\faPuzzlePiece}{LightSeaGreen}[White]
\cpnewbox{cattention}{Attention}{\faExclamationTriangle}{Red}
\cpnewbox{ccode}{Code}{\faCode}{Crimson}[White]
\cpnewbox{cpython}{Python}{\faPython}{SeaGreen}[White]

%outil
\newtcolorbox{coutilcalc}[1][]{%
	cdefaut,%
	colframe=DeepSkyBlue,coltitle=black,colbacktitle=DeepSkyBlue!35,colback=White,
	title=\textcolor{DeepSkyBlue!25!Black}{\faFileVideo[regular]\:\:\titrebox{Tuto#1 Vidéo}}
}

%loglogo
\newtcolorbox{cloglogo}[2][]{%
	cdefaut,%
	colframe=CornflowerBlue,coltitle=black,colbacktitle=CornflowerBlue!35,colback=white,
	title=\textcolor{CornflowerBlue!25!Black}{\faDev\:\:\titrebox{Logiciel#1}},
	overlay={\begin{tcbclipinterior}
			\node[opacity=0.33,rotate=-45] at ($(interior.south east)+(-10pt,10pt)$){\includegraphics[height=24pt]{#2}};
	\end{tcbclipinterior}}
}

%demo
\newtcolorbox{cdemo}[1][]{%
	cdefaut,%
	colframe=Violet,coltitle=black,colbacktitle=Violet!35,colback=Violet!15,
	title=\textcolor{Violet!25!Black}{\faEdit[regular]\:\:\titrebox{Démonstration#1}},
	overlay={\begin{tcbclipinterior}%
			\node[] at ($(interior.south east)+(-10pt,10pt)$){\large\textcolor{Violet}{\textbf{\CheckedBox}}};%
	\end{tcbclipinterior}}
}

%demoblanc
\newtcolorbox{cdemoblanc}[1][]{%
	cdefaut,%
	colframe=Violet,coltitle=black,colbacktitle=Violet!35,colback=White,
	title=\textcolor{Violet!25!Black}{\faEdit[regular]\:\:\titrebox{Démonstration#1}},
	overlay={\begin{tcbclipinterior}%
			\node[] at ($(interior.south east)+(-10pt,10pt)$){\large\textcolor{Violet}{\textbf{\CheckedBox}}};%
	\end{tcbclipinterior}}
}

%algo
\newtcolorbox{calgo}[1][]{%
	cdefaut,%
	colframe=OrangeRed,coltitle=black,colbacktitle=OrangeRed!35,colback=White,
	title=\textcolor{OrangeRed!25!Black}{\faFileCode\:\:\titrebox{Algorithme#1}},
	overlay={\begin{tcbclipinterior}%
			\node[opacity=0.15,rotate=-15] at ($(interior.south east)+(-8pt,12pt)$){\includegraphics[height=24pt]{algorithmvec}};%
	\end{tcbclipinterior}}
}


%aide
\newtcolorbox{caide}{%
	cdefaut,%
	colframe=titrebleu!35,coltitle=titrebleu!50!Black,colbacktitle=titrebleu!15,colback=White,
	title=\textcolor{titrebleu!25!Black}{\faBacon\:\:\titrebox{Niveaux de difficulté}},
	overlay={\begin{tcbclipinterior}%
			\node[opacity=0.33,rotate=45,scale=0.33] at ($(interior.south east)+(-6pt,6pt)$){\textcolor{titrebleu!50!Black}{\footnotesize \bfseries \sffamily \textcopyright{} Dairon11}};%
	\end{tcbclipinterior}}
}

\newtcolorbox{ccalcologo}[2][]{%
	cdefaut,%
	colframe=MediumVioletRed,coltitle=black,colbacktitle=MediumVioletRed!35,colback=White,
	title=\textcolor{MediumVioletRed!25!Black}{\faCalculator\:\:\titrebox{Calculatrice#1}},
	overlay={\begin{tcbclipinterior}%
			\node[opacity=0.33,rotate=-45] at ($(interior.south east)+(-10pt,10pt)$){\includegraphics[height=48pt]{#2}};%
	\end{tcbclipinterior}}
}

\definecolor{orangescratch}{HTML}{F8A31F}
\newtcolorbox{cscratch}[1][]{%
	cdefaut,%
	colframe=orangescratch,coltitle=black,colbacktitle=orangescratch!35,colback=White,
	title=\textcolor{orange!25!Black}{\includegraphics[height=1em]{scratch}\:\:\titrebox{Scratch#1}},
	overlay={\begin{tcbclipinterior}%
			\node[opacity=0.33,rotate=45] at ($(interior.south east)+(-12pt,12pt)$){\includegraphics[height=12pt]{scratchban}};%
	\end{tcbclipinterior}}
}

%reponse
\newtcolorbox{creponse}[1][]{%
	cdefaut,%
	colframe=Thistle,coltitle=black,colbacktitle=Thistle!35,colback=White,
	before upper = \vspace{-0.05cm},
	title=\textcolor{Thistle!25!Black}{\faIcon{pen-alt}\:\:\titrebox{Réponse#1}}
}

\endinput